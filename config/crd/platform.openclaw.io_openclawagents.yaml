---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: openclawagents.platform.openclaw.io
spec:
  group: platform.openclaw.io
  names:
    kind: OpenClawAgent
    listKind: OpenClawAgentList
    plural: openclawagents
    singular: openclawagent
    shortNames:
      - oca
      - agent
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Mode
          type: string
          jsonPath: .spec.containerMode
        - name: Profile
          type: string
          jsonPath: .spec.immutableProfile
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Swarm
          type: string
          jsonPath: .status.swarm.swarmID
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          description: OpenClawAgent is the Schema for the openclawagents API
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              description: OpenClawAgentSpec defines the desired state of OpenClawAgent
              properties:
                containerMode:
                  type: string
                  enum: [immutable, dynamic]
                  default: immutable
                  description: ContainerMode specifies whether to use immutable or dynamic containers
                immutableProfile:
                  type: string
                  enum: [minimal, python-ml, devops, web, data, security]
                  default: minimal
                  description: ImmutableProfile specifies which pre-baked image to use
                runtime:
                  type: object
                  description: Runtime configuration for the agent container
                  properties:
                    image:
                      type: string
                    imagePullPolicy:
                      type: string
                      enum: [Always, Never, IfNotPresent]
                      default: IfNotPresent
                    command:
                      type: array
                      items:
                        type: string
                    args:
                      type: array
                      items:
                        type: string
                    env:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                          valueFrom:
                            type: object
                            properties:
                              configMapKeyRef:
                                type: object
                                properties:
                                  name:
                                    type: string
                                  key:
                                    type: string
                              secretKeyRef:
                                type: object
                                properties:
                                  name:
                                    type: string
                                  key:
                                    type: string
                identity:
                  type: object
                  description: Identity defines the agent's identity (IDENTITY.md)
                  properties:
                    configMap:
                      type: string
                    secret:
                      type: string
                    git:
                      type: string
                    inline:
                      type: string
                soul:
                  type: object
                  description: Soul defines the agent's behavioral traits (SOUL.md)
                  properties:
                    configMap:
                      type: string
                    secret:
                      type: string
                    git:
                      type: string
                    inline:
                      type: string
                memory:
                  type: object
                  description: Memory defines hierarchical memory configuration
                  required: [natsUrl]
                  properties:
                    natsUrl:
                      type: string
                      default: "nats://nats.openclaw.svc:4222"
                    company:
                      type: object
                      properties:
                        enabled:
                          type: boolean
                          default: true
                        mode:
                          type: string
                          enum: [readonly, readwrite]
                          default: readonly
                        buckets:
                          type: array
                          items:
                            type: string
                    group:
                      type: object
                      required: [name]
                      properties:
                        enabled:
                          type: boolean
                          default: true
                        name:
                          type: string
                        mode:
                          type: string
                          enum: [readonly, readwrite]
                          default: readwrite
                        crossGroupRead:
                          type: array
                          items:
                            type: string
                    swarm:
                      type: object
                      properties:
                        enabled:
                          type: boolean
                          default: true
                        autoJoin:
                          type: boolean
                          default: true
                        currentSwarmID:
                          type: string
                    individual:
                      type: object
                      properties:
                        enabled:
                          type: boolean
                          default: true
                        bucket:
                          type: string
                        ttl:
                          type: string
                swarm:
                  type: object
                  description: Swarm participation configuration
                  properties:
                    enabled:
                      type: boolean
                      default: false
                    role:
                      type: string
                      enum: [worker, orchestrator]
                      default: worker
                    groups:
                      type: array
                      items:
                        type: string
                    maxShards:
                      type: integer
                      default: 1
                    maxWorkers:
                      type: integer
                      default: 10
                    shardTimeout:
                      type: string
                mutability:
                  type: object
                  description: Mutability defines writable paths for dynamic containers
                  properties:
                    enabled:
                      type: boolean
                      default: false
                    toolPaths:
                      type: array
                      items:
                        type: string
                      default: ["/opt/openclaw/tools", "/opt/openclaw/runtime"]
                    persistTools:
                      type: boolean
                      default: false
                    toolCachePVC:
                      type: string
                capabilities:
                  type: array
                  items:
                    type: string
                resources:
                  type: object
                  properties:
                    limits:
                      type: object
                      additionalProperties:
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
                    requests:
                      type: object
                      additionalProperties:
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
            status:
              type: object
              description: OpenClawAgentStatus defines the observed state of OpenClawAgent
              properties:
                phase:
                  type: string
                  enum: [Pending, Initializing, Ready, Running, Failed, Terminated]
                conditions:
                  type: array
                  items:
                    type: object
                    required: [type, status]
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                podName:
                  type: string
                memory:
                  type: object
                  properties:
                    connected:
                      type: boolean
                    companyAccess:
                      type: boolean
                    groupAccess:
                      type: boolean
                    swarmAccess:
                      type: boolean
                    individualBucket:
                      type: string
                swarm:
                  type: object
                  properties:
                    active:
                      type: boolean
                    swarmID:
                      type: string
                    role:
                      type: string
                      enum: [worker, orchestrator]
                    shardID:
                      type: string
                    workerCount:
                      type: integer
                startTime:
                  type: string
                  format: date-time
                lastHeartbeat:
                  type: string
                  format: date-time
